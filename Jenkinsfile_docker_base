pipeline {
    agent any
    triggers {
        pollSCM('*/1 * * * *')
    }
    stages {
        stage('build-stg') {
            steps {
                build('stg')
            }
        }
        stage('deploy-stg') {
            steps {
                script {
                    deploy('stg')
                }
            }
        }
        stage('test-stg') {
            steps {
                script {
                    test('stg')
                }
            }
        }
        stage('build-prd') {
            steps {
                build('prd')
            }
        }
        stage('deploy-prd') {
            steps {
                script {
                    deploy('prd')
                }
            }
        }
        stage('test-prd') {
            steps {
                script {
                    test('prd')
                }
            }
        }
    }
    post {
        success {
            echo "Success!"
        }
        failure {
            script {
                error "Failure!"
            }
        }
    }
}

def build(String environment){
    echo "Building to ${environment} triggered..."
    build job: "docker_build", parameters: [string(name: "environment", value: "${environment}")]
    sh "./ui-automation /send_notification.sh 'building on ${environment}'"
}

def deploy(String environment){
    echo "Deployment to ${environment} environment..."
    sh "./ui-automation /send_notification.sh 'building on ${environment}'"

}

def test(String environment){
    echo "Running tests on ${environment} environment..."
    sh "./ui-automation /send_notification.sh 'building on ${environment}'"
}